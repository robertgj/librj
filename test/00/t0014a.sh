#!/bin/sh
#
prog="splayTree_interp"
tmp=/tmp/$$
here=`pwd`
bin=$here/bin
if [ $? -ne 0 ]; then echo "Failed pwd"; exit 1; fi


fail()
{
        echo FAILED $prog 1>&2
        cd $here
        rm -rf $tmp
        exit 1
}


pass()
{
        echo PASSED $prog
        cd $here
        rm -rf $tmp
        exit 0
}

trap "fail" 1 2 3 15
mkdir $tmp
if [ $? -ne 0 ]; then echo "Failed mkdir"; exit 1; fi
cd $tmp
if [ $? -ne 0 ]; then echo "Failed cd"; fail; fi

#
# the input should look like this
#
cat > test.in << 'EOF'
# Another splayTreeBalance() test
for(x=0; x<513; x=x+1;)
{
  l=create();
  for (y=0;y<x;y=y+1;)
  {  
    insert(l, y);
  }
  balance(l);
  z=size(l);
  "Size"; print z;
  z=depth(l);
  "Depth"; print z;
  destroy(l);
}
EOF
if [ $? -ne 0 ]; then echo "Failed input cat"; fail; fi

#
# the output should look like this
#
cat > test.ok << 'EOF'
Size
0
Depth
0
Size
1
Depth
1
Size
2
Depth
2
Size
3
Depth
2
Size
4
Depth
3
Size
5
Depth
3
Size
6
Depth
3
Size
7
Depth
3
Size
8
Depth
4
Size
9
Depth
4
Size
10
Depth
4
Size
11
Depth
4
Size
12
Depth
4
Size
13
Depth
4
Size
14
Depth
4
Size
15
Depth
4
Size
16
Depth
5
Size
17
Depth
5
Size
18
Depth
5
Size
19
Depth
5
Size
20
Depth
5
Size
21
Depth
5
Size
22
Depth
5
Size
23
Depth
5
Size
24
Depth
5
Size
25
Depth
5
Size
26
Depth
5
Size
27
Depth
5
Size
28
Depth
5
Size
29
Depth
5
Size
30
Depth
5
Size
31
Depth
5
Size
32
Depth
6
Size
33
Depth
6
Size
34
Depth
6
Size
35
Depth
6
Size
36
Depth
6
Size
37
Depth
6
Size
38
Depth
6
Size
39
Depth
6
Size
40
Depth
6
Size
41
Depth
6
Size
42
Depth
6
Size
43
Depth
6
Size
44
Depth
6
Size
45
Depth
6
Size
46
Depth
6
Size
47
Depth
6
Size
48
Depth
6
Size
49
Depth
6
Size
50
Depth
6
Size
51
Depth
6
Size
52
Depth
6
Size
53
Depth
6
Size
54
Depth
6
Size
55
Depth
6
Size
56
Depth
6
Size
57
Depth
6
Size
58
Depth
6
Size
59
Depth
6
Size
60
Depth
6
Size
61
Depth
6
Size
62
Depth
6
Size
63
Depth
6
Size
64
Depth
7
Size
65
Depth
7
Size
66
Depth
7
Size
67
Depth
7
Size
68
Depth
7
Size
69
Depth
7
Size
70
Depth
7
Size
71
Depth
7
Size
72
Depth
7
Size
73
Depth
7
Size
74
Depth
7
Size
75
Depth
7
Size
76
Depth
7
Size
77
Depth
7
Size
78
Depth
7
Size
79
Depth
7
Size
80
Depth
7
Size
81
Depth
7
Size
82
Depth
7
Size
83
Depth
7
Size
84
Depth
7
Size
85
Depth
7
Size
86
Depth
7
Size
87
Depth
7
Size
88
Depth
7
Size
89
Depth
7
Size
90
Depth
7
Size
91
Depth
7
Size
92
Depth
7
Size
93
Depth
7
Size
94
Depth
7
Size
95
Depth
7
Size
96
Depth
7
Size
97
Depth
7
Size
98
Depth
7
Size
99
Depth
7
Size
100
Depth
7
Size
101
Depth
7
Size
102
Depth
7
Size
103
Depth
7
Size
104
Depth
7
Size
105
Depth
7
Size
106
Depth
7
Size
107
Depth
7
Size
108
Depth
7
Size
109
Depth
7
Size
110
Depth
7
Size
111
Depth
7
Size
112
Depth
7
Size
113
Depth
7
Size
114
Depth
7
Size
115
Depth
7
Size
116
Depth
7
Size
117
Depth
7
Size
118
Depth
7
Size
119
Depth
7
Size
120
Depth
7
Size
121
Depth
7
Size
122
Depth
7
Size
123
Depth
7
Size
124
Depth
7
Size
125
Depth
7
Size
126
Depth
7
Size
127
Depth
7
Size
128
Depth
8
Size
129
Depth
8
Size
130
Depth
8
Size
131
Depth
8
Size
132
Depth
8
Size
133
Depth
8
Size
134
Depth
8
Size
135
Depth
8
Size
136
Depth
8
Size
137
Depth
8
Size
138
Depth
8
Size
139
Depth
8
Size
140
Depth
8
Size
141
Depth
8
Size
142
Depth
8
Size
143
Depth
8
Size
144
Depth
8
Size
145
Depth
8
Size
146
Depth
8
Size
147
Depth
8
Size
148
Depth
8
Size
149
Depth
8
Size
150
Depth
8
Size
151
Depth
8
Size
152
Depth
8
Size
153
Depth
8
Size
154
Depth
8
Size
155
Depth
8
Size
156
Depth
8
Size
157
Depth
8
Size
158
Depth
8
Size
159
Depth
8
Size
160
Depth
8
Size
161
Depth
8
Size
162
Depth
8
Size
163
Depth
8
Size
164
Depth
8
Size
165
Depth
8
Size
166
Depth
8
Size
167
Depth
8
Size
168
Depth
8
Size
169
Depth
8
Size
170
Depth
8
Size
171
Depth
8
Size
172
Depth
8
Size
173
Depth
8
Size
174
Depth
8
Size
175
Depth
8
Size
176
Depth
8
Size
177
Depth
8
Size
178
Depth
8
Size
179
Depth
8
Size
180
Depth
8
Size
181
Depth
8
Size
182
Depth
8
Size
183
Depth
8
Size
184
Depth
8
Size
185
Depth
8
Size
186
Depth
8
Size
187
Depth
8
Size
188
Depth
8
Size
189
Depth
8
Size
190
Depth
8
Size
191
Depth
8
Size
192
Depth
8
Size
193
Depth
8
Size
194
Depth
8
Size
195
Depth
8
Size
196
Depth
8
Size
197
Depth
8
Size
198
Depth
8
Size
199
Depth
8
Size
200
Depth
8
Size
201
Depth
8
Size
202
Depth
8
Size
203
Depth
8
Size
204
Depth
8
Size
205
Depth
8
Size
206
Depth
8
Size
207
Depth
8
Size
208
Depth
8
Size
209
Depth
8
Size
210
Depth
8
Size
211
Depth
8
Size
212
Depth
8
Size
213
Depth
8
Size
214
Depth
8
Size
215
Depth
8
Size
216
Depth
8
Size
217
Depth
8
Size
218
Depth
8
Size
219
Depth
8
Size
220
Depth
8
Size
221
Depth
8
Size
222
Depth
8
Size
223
Depth
8
Size
224
Depth
8
Size
225
Depth
8
Size
226
Depth
8
Size
227
Depth
8
Size
228
Depth
8
Size
229
Depth
8
Size
230
Depth
8
Size
231
Depth
8
Size
232
Depth
8
Size
233
Depth
8
Size
234
Depth
8
Size
235
Depth
8
Size
236
Depth
8
Size
237
Depth
8
Size
238
Depth
8
Size
239
Depth
8
Size
240
Depth
8
Size
241
Depth
8
Size
242
Depth
8
Size
243
Depth
8
Size
244
Depth
8
Size
245
Depth
8
Size
246
Depth
8
Size
247
Depth
8
Size
248
Depth
8
Size
249
Depth
8
Size
250
Depth
8
Size
251
Depth
8
Size
252
Depth
8
Size
253
Depth
8
Size
254
Depth
8
Size
255
Depth
8
Size
256
Depth
9
Size
257
Depth
9
Size
258
Depth
9
Size
259
Depth
9
Size
260
Depth
9
Size
261
Depth
9
Size
262
Depth
9
Size
263
Depth
9
Size
264
Depth
9
Size
265
Depth
9
Size
266
Depth
9
Size
267
Depth
9
Size
268
Depth
9
Size
269
Depth
9
Size
270
Depth
9
Size
271
Depth
9
Size
272
Depth
9
Size
273
Depth
9
Size
274
Depth
9
Size
275
Depth
9
Size
276
Depth
9
Size
277
Depth
9
Size
278
Depth
9
Size
279
Depth
9
Size
280
Depth
9
Size
281
Depth
9
Size
282
Depth
9
Size
283
Depth
9
Size
284
Depth
9
Size
285
Depth
9
Size
286
Depth
9
Size
287
Depth
9
Size
288
Depth
9
Size
289
Depth
9
Size
290
Depth
9
Size
291
Depth
9
Size
292
Depth
9
Size
293
Depth
9
Size
294
Depth
9
Size
295
Depth
9
Size
296
Depth
9
Size
297
Depth
9
Size
298
Depth
9
Size
299
Depth
9
Size
300
Depth
9
Size
301
Depth
9
Size
302
Depth
9
Size
303
Depth
9
Size
304
Depth
9
Size
305
Depth
9
Size
306
Depth
9
Size
307
Depth
9
Size
308
Depth
9
Size
309
Depth
9
Size
310
Depth
9
Size
311
Depth
9
Size
312
Depth
9
Size
313
Depth
9
Size
314
Depth
9
Size
315
Depth
9
Size
316
Depth
9
Size
317
Depth
9
Size
318
Depth
9
Size
319
Depth
9
Size
320
Depth
9
Size
321
Depth
9
Size
322
Depth
9
Size
323
Depth
9
Size
324
Depth
9
Size
325
Depth
9
Size
326
Depth
9
Size
327
Depth
9
Size
328
Depth
9
Size
329
Depth
9
Size
330
Depth
9
Size
331
Depth
9
Size
332
Depth
9
Size
333
Depth
9
Size
334
Depth
9
Size
335
Depth
9
Size
336
Depth
9
Size
337
Depth
9
Size
338
Depth
9
Size
339
Depth
9
Size
340
Depth
9
Size
341
Depth
9
Size
342
Depth
9
Size
343
Depth
9
Size
344
Depth
9
Size
345
Depth
9
Size
346
Depth
9
Size
347
Depth
9
Size
348
Depth
9
Size
349
Depth
9
Size
350
Depth
9
Size
351
Depth
9
Size
352
Depth
9
Size
353
Depth
9
Size
354
Depth
9
Size
355
Depth
9
Size
356
Depth
9
Size
357
Depth
9
Size
358
Depth
9
Size
359
Depth
9
Size
360
Depth
9
Size
361
Depth
9
Size
362
Depth
9
Size
363
Depth
9
Size
364
Depth
9
Size
365
Depth
9
Size
366
Depth
9
Size
367
Depth
9
Size
368
Depth
9
Size
369
Depth
9
Size
370
Depth
9
Size
371
Depth
9
Size
372
Depth
9
Size
373
Depth
9
Size
374
Depth
9
Size
375
Depth
9
Size
376
Depth
9
Size
377
Depth
9
Size
378
Depth
9
Size
379
Depth
9
Size
380
Depth
9
Size
381
Depth
9
Size
382
Depth
9
Size
383
Depth
9
Size
384
Depth
9
Size
385
Depth
9
Size
386
Depth
9
Size
387
Depth
9
Size
388
Depth
9
Size
389
Depth
9
Size
390
Depth
9
Size
391
Depth
9
Size
392
Depth
9
Size
393
Depth
9
Size
394
Depth
9
Size
395
Depth
9
Size
396
Depth
9
Size
397
Depth
9
Size
398
Depth
9
Size
399
Depth
9
Size
400
Depth
9
Size
401
Depth
9
Size
402
Depth
9
Size
403
Depth
9
Size
404
Depth
9
Size
405
Depth
9
Size
406
Depth
9
Size
407
Depth
9
Size
408
Depth
9
Size
409
Depth
9
Size
410
Depth
9
Size
411
Depth
9
Size
412
Depth
9
Size
413
Depth
9
Size
414
Depth
9
Size
415
Depth
9
Size
416
Depth
9
Size
417
Depth
9
Size
418
Depth
9
Size
419
Depth
9
Size
420
Depth
9
Size
421
Depth
9
Size
422
Depth
9
Size
423
Depth
9
Size
424
Depth
9
Size
425
Depth
9
Size
426
Depth
9
Size
427
Depth
9
Size
428
Depth
9
Size
429
Depth
9
Size
430
Depth
9
Size
431
Depth
9
Size
432
Depth
9
Size
433
Depth
9
Size
434
Depth
9
Size
435
Depth
9
Size
436
Depth
9
Size
437
Depth
9
Size
438
Depth
9
Size
439
Depth
9
Size
440
Depth
9
Size
441
Depth
9
Size
442
Depth
9
Size
443
Depth
9
Size
444
Depth
9
Size
445
Depth
9
Size
446
Depth
9
Size
447
Depth
9
Size
448
Depth
9
Size
449
Depth
9
Size
450
Depth
9
Size
451
Depth
9
Size
452
Depth
9
Size
453
Depth
9
Size
454
Depth
9
Size
455
Depth
9
Size
456
Depth
9
Size
457
Depth
9
Size
458
Depth
9
Size
459
Depth
9
Size
460
Depth
9
Size
461
Depth
9
Size
462
Depth
9
Size
463
Depth
9
Size
464
Depth
9
Size
465
Depth
9
Size
466
Depth
9
Size
467
Depth
9
Size
468
Depth
9
Size
469
Depth
9
Size
470
Depth
9
Size
471
Depth
9
Size
472
Depth
9
Size
473
Depth
9
Size
474
Depth
9
Size
475
Depth
9
Size
476
Depth
9
Size
477
Depth
9
Size
478
Depth
9
Size
479
Depth
9
Size
480
Depth
9
Size
481
Depth
9
Size
482
Depth
9
Size
483
Depth
9
Size
484
Depth
9
Size
485
Depth
9
Size
486
Depth
9
Size
487
Depth
9
Size
488
Depth
9
Size
489
Depth
9
Size
490
Depth
9
Size
491
Depth
9
Size
492
Depth
9
Size
493
Depth
9
Size
494
Depth
9
Size
495
Depth
9
Size
496
Depth
9
Size
497
Depth
9
Size
498
Depth
9
Size
499
Depth
9
Size
500
Depth
9
Size
501
Depth
9
Size
502
Depth
9
Size
503
Depth
9
Size
504
Depth
9
Size
505
Depth
9
Size
506
Depth
9
Size
507
Depth
9
Size
508
Depth
9
Size
509
Depth
9
Size
510
Depth
9
Size
511
Depth
9
Size
512
Depth
10
EOF
if [ $? -ne 0 ]; then echo "Failed output cat"; fail; fi


#
# run and see if the results match
#
$VALGRIND_CMD $bin/$prog <test.in >test.out
if [ $? -ne 0 ]; then echo "Failed running $prog"; fail; fi
diff test.ok test.out
if [ $? -ne 0 ]; then echo "Failed diff"; fail; fi


#
# this much worked
#
pass
